# Web Development Basics

This chapter will explain what happens when you open websites, and how JavaScript is executed. A small example framework is given at the end, with which you can build your own small web application.

Open the VS solution, set the Empires In Space Index project as Startup Project and start it by pressing F5.
Make sure that the you use a web browser which has developer tools. Firefox, IE, Edge and chrome all do have those.  
Open the developer tools, they can be found in the browser settings. Alternatively, press Ctrl+Shift+i or F12, depending on your browser. The following describes what Chrome and Edge do show, but Firefox and IE are not that different.  

The developer tools are a very important tool, used for analyzing websites, debugging, trying out css and much more, and you will probably use them a lot.   

With the dev tools open, reload the page by pressing F5. Go to the Network tab and select the top entry, which will show that you requested data from www.EmpiresInSpace.com.  

The request tab page shows additional information of the web request. There is data that was sent to the web server in the Request Header (like language preferences, used web browser, cookies), along with data that was returned in the Response Header and the Status Code 200 (this would e.g. be the well known 404 if the server wouldn't find the requested page).  
But the main data returned by server is shown in the Response tab. You will see the source code of the current website here.  

When the web browser opens an URl, it makes a get request, gets the response and begins to evaluate the response line by line. HTML elements are put into the DOM (Document Object Model), images are loaded, scripts are loaded the moment the line is evaluated by the server, and they are instantly executed. All along, the site is also being drawn on the screen.
We can now compare the source code of the site with that of our Empires In Space index project. Open it in the VS and open file Index.aspx.  

The only difference between the index.aspx and the response shown in the web browser are (in the VS file) the uppermost line and a few other places where <% %> contains function calls. This is evaluated by the web server the moment the page is requested, and the result of the functions is embedded in the web page and send to the browser. You will find the sourcode (called "code behind") to that either by clicking on the function and pressing F12 (or right click and selecting "Go to Definition"), or by opening the Code Behing file by using the arrow left of the filename in the Solution Explorer, and clicking on Index.aspx.cs. The .designer.cs files which are here and in other parts are generated by the visual studio atumatically and should not be changed manually.  

Back to the web browser and JavaScript execution. I wrote that the JavaScript is executed the moment it is loaded - in most cases that means that objects (functions) are created.

~~~~
function a(){return 1}
~~~~

is the same as 

~~~~
let a = function(){return 1}
~~~~

On execution, both create the function a. The second example clarifies that a is an object. Since JavaScript is dynamically typed,  you can e.g. write

~~~~
a.x = 2
~~~~

Now the member variable x was added to a, with the value 2.
Execution takes place as in many other languages by placing () behind the variable name (and putting parameter values inside the brackets if needed).  
a() will return 1, a.x returns 2.  

You can try these things out in the developer tools by switching to the Console tab and entering them in the command line at the bottom.  


Empires In Space uses JavaScript to change the behaviour of the website, react on user input, changing, adding or deleting HTTP elements and much more. Most of this requires that the website is fully loaded - so the earliest point in time that theses scripts are executed is **after** the page was loaded.  
This can be assured by putting the HTML script element at the bottom of the webpage, or by using the pageloaded event that web browsers fire after having loaded a web page. We are using the second method in the last line of file index/index.ts.

~~~~
$(document).ready(pageIndex.myOnLoad);
~~~~

The $ character calls JQuery, document is a JavaScript object which is automatically created for each website and described here:  
https://www.w3schools.com/js/js_htmldom_document.asp  
Take a look a that documentation and the method calls available on document.

JQuery is mostly used to fetch HTML elements: $("#AnIdUsed") and $(".AcSSclassNameUsed") are a bit similar to the getElement(s) method on document. These methods return a JQuery object, which also has a handful of useful methods which are sometimes used.
And a very nice thing is that one can put any css selector into the JQuery call to find one or more element on the page
https://www.w3schools.com/css/css_selectors.asp

Back to the .ready(pageIndex.myOnLoad) call above: This adds the pageIndex.myOnLoad function to the list of functions which is called after page load. In pure Javascript, one could use 
~~~~
window.onload = pageIndex.myOnLoad
~~~~
with the same result. If you take a look at pageIndex.myOnLoad, you will see that a lot of HTML elements are referenced, which is the reason why the source code requires the page to be loaded.  



You should now have enough background information to create a small javascript web application. I would recommand using a lightweight text editor like notepad++ for this. Create a new file game.html, paste the following code into it and use that as a framework.
~~~~
<html>
    <head>

	</head>
    <body>
	<canvas id="canvas" width=300 height=300 style="border:1px solid gold"></canvas>
	<div id="output">		
	</div>
	</body>
	<script>
	
	//First part to handle key events:
	let key;
	let output = document.getElementById("output");
	
	//Change the inner text of the HTML element with the id "output"
	function showKey()
	{
		switch(key)
		{
			case 65:
				output.innerText = "a was pressed";
				break;
			case 38:
				output.innerText = "Arrow up was pressed";
				break;
			case null:
				output.innerText = "No key pressed";
				break;
			default:
				output.innerText = "Unknown key: " + key;
		}
	}
	
	setInterval(showKey, 500);
	
	function keyDown(event)
	{
		if(window.event) { // IE                    
		  key =  window.event.keyCode;
		} else if(event.which){ // Netscape/Firefox/Opera                   
		  key = event.which;
		}
		
		//the distinction above is required due to different implementations of the keyDown event
		//https://stackoverflow.com/questions/1846599/how-to-find-out-what-character-key-is-pressed
	}
	
	document.onkeydown=keyDown;
	document.onkeyup = function(){key = null};
		
	//second part to have a gameloop which handles user input
	let waitingTime = 200;
	
	let myCoordinates = {x:7,y:7};  //an object (create by {}) with the member variables x and y
	
	//You will also need the javascript array object : https://www.w3schools.com/js/js_arrays.asp

	function gameLoop()
	{
		//console.log(key);
		switch(key)
		{
		
			case 37:
				myCoordinates.x--;				
				break;
			case 38:
				myCoordinates.y--;
				break;				
			case 39:
				myCoordinates.x++;				
				break;
			case 40:
				myCoordinates.y++;	
				break;				
			case null:	
				break;
			default:
		}

	}

	
	let timer = setInterval(gameLoop, waitingTime);
	
	//third part to have a loop which refreshed the canvas element
	let canvas=document.getElementById("canvas")
	let context=canvas.getContext("2d")
	let fieldSize=20;
	
	function draw() {
		//first clear the canvas by putting a big white rectangle over everything
		context.fillStyle="#FFFFFF";
		context.fillRect(0,0,300,300);
		
		//then draw something
		context.fillStyle="#00FF00";
		context.fillRect(myCoordinates.x*fieldSize,myCoordinates.y*fieldSize,fieldSize,fieldSize);
	}
	
	window.setInterval(draw, 10);
	
	</script>     
</html>
~~~~

Open the file with a browser and try out the arrow keys.  

Open the developer tools and examine your source code. You can set breakpoints in the Sources tab, and execute the program step by step. During this debugging, you can also examine and change the value of the variables.  
A small game like snake or minesweeper can be developed in a few hours - have fun.








